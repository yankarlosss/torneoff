<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados Torneo Free Fire</title>
    <link rel="stylesheet" href="style-results.css">
    <style>
        .fade-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        #top6-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            padding: 20px;
            justify-content: center;
            align-items: center;
            max-width: 900px;
            margin: auto;
        }
        
        .team-card {
            width: 270px;
            padding: 15px;
        }
    </style>
</head>
<body>
    <table id="results-table">
        <thead>
            <tr>
                <th>Posición</th>
                <th>Logo</th>
                <th>Equipo</th>
                <th>Kills</th>
                <th>Puntos</th>
            </tr>
        </thead>
        <tbody>
            <!-- Resultados se cargarán aquí -->
        </tbody>
    </table>

    <script type="module">
        // ✅ 1. Importa lo necesario de Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-database.js";

        // ✅ 2. Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDoqAGJaDgotg4Ov2TNOEz-JuKuoLqzjWM",
            authDomain: "torneo-crack-cup.firebaseapp.com",
            projectId: "torneo-crack-cup",
            storageBucket: "torneo-crack-cup.appspot.com",
            messagingSenderId: "1245957614",
            appId: "1:1245957614:web:42ec92c7df010052a852ff",
            measurementId: "G-QPL8KEKWKD"
        };

        // ✅ 3. Inicializa Firebase aquí, de forma global
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // ✅ 4. Función para actualizar los resultados
        function updateResults() {
            onValue(ref(database, 'teams'), (snapshot) => {
                const teams = [];
                snapshot.forEach((childSnapshot) => {
                    const teamData = childSnapshot.val();
                    const teamKey = childSnapshot.key;
                    teams.push({ key: teamKey, ...teamData });
                });

                const sortedTeams = teams.sort((a, b) => (b.points || 0) - (a.points || 0));
                const tbody = document.querySelector('#results-table tbody');

                const previousOrder = [...tbody.children].map(row => row.dataset.teamName);
                
                tbody.innerHTML = '';

                sortedTeams.forEach((team, index) => {
                    const row = document.createElement('tr');
                    row.dataset.teamName = team.name; // Guardar nombre del equipo en dataset

                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td><img src="${team.logo}" alt="${team.name} Logo" class="team-logo"></td>
                        <td>${team.name}</td>
                        <td>${team.kills || 0}</td>
                        <td>${team.points || 0}</td>
                    `;

                    // Si la posición cambió, añadir la animación
                    if (previousOrder.includes(team.name) && previousOrder.indexOf(team.name) !== index) {
                        row.classList.add('changed');
                        setTimeout(() => row.classList.remove('changed'), 1000); // Remover clase después de 1 seg
                    }

                    tbody.appendChild(row);
                });
            });
        }

        // ✅ 5. Cargar los resultados cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', () => {
            updateResults();
        });
    </script>
</body>
</html>
